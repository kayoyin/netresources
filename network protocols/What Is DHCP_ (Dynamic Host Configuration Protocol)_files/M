var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,t){n.__proto__=t}||function(n,t){for(var i in t)t.hasOwnProperty(i)&&(n[i]=t[i])};return function(t,i){function r(){this.constructor=t}n(t,i);t.prototype=i===null?Object.create(i):(r.prototype=i.prototype,new r)}}(),PostType,DataWrapper;(function(n){n[n.OnLoad=0]="OnLoad";n[n.OnBeforeUnload=1]="OnBeforeUnload";n[n.OnAbort=2]="OnAbort";n[n.Flush=3]="Flush"})(PostType||(PostType={}));DataWrapper=function(){function n(){this.hasErrors=!1;this._appErrors=null;this.hasIndicators=!1;this._indicators=null;this.hasTracepoints=!1;this._tracepoints=null}return n.prototype.addError=function(n,t){this.hasErrors||(this._appErrors={},this.hasErrors=!0);this._appErrors[n]=t},n.prototype.getErrors=function(){return this._appErrors},n.prototype.addIndicator=function(n){this.hasIndicators||(this._indicators={},this.hasIndicators=!0);for(var t in n)this._indicators[t]=n[t]},n.prototype.getIndicators=function(){return this._indicators},n.prototype.addTracepoint=function(n){this.hasTracepoints||(this._tracepoints={},this.hasTracepoints=!0);for(var t in n)this._tracepoints[t]=n[t]},n.prototype.getTracepoints=function(){return this._tracepoints},n}(),function(){var h,u,f,c,i;if(document.getElementById&&(window.attachEvent||window.addEventListener)){var n=parent.window,o=n.location,t=n.RProfiler,e=n.WindowEvent,l=o.protocol+"//",rt=t.version,s={Load:e.Load,BeforeUnload:e.BeforeUnload,Unload:e.Unload,Abort:e.Abort,Error:e.Error},a="test",b="v3.1.4",r={sampleRate:100,waterfallSampleRate:5,postUrl:l+"r.3gl.net/hawklogserver/r.p",siteId:552,debugParameter:"GlimpseDebug",debugUrl:"g.3gl.net/jp/v3.1.4/D",waterfallParameter:"GlimpseWaterfall",sendOnLoad:!1,clearResources:!0};!n.__cpPostUrl||(r.postUrl=n.__cpPostUrl.trim());!n.__cpSendOnLoad||(r.sendOnLoad=n.__cpSendOnLoad===!0);h=function(){function t(){}return t.save=function(i){if(t.canUseLocalStorage()){n.localStorage.setItem(t.storeKey,i);return}t.setCookie(i)},t.read=function(){if(t.canUseLocalStorage()){var i=n.localStorage.getItem(t.storeKey);if(i)return i}return this.readCookie()},t.canUseLocalStorage=function(){var r=!0,i,u,f;try{i=t.storeKey+"delete";u=i+0;n.localStorage.setItem(i,u);f=n.localStorage.getItem(i);r=u===f;r&&n.localStorage.removeItem(i)}catch(e){r=!1}return r},t.setCookie=function(i){var r=new Date;r.setTime(r.getTime()+t.cookieExpireDays*864e5);var e="; expires="+r.toUTCString(),u=n.document.domain.split("."),f=u.length,o=u[f-2]+"."+u[f-1];document.cookie=t.storeKey+"="+encodeURIComponent(i)+e+"; path=/; domain="+o+";"},t.readCookie=function(){for(var i,f=n.document.cookie.split(";"),e=t.storeRegex,r=0,u=f;r<u.length;r++)if(i=u[r],e.test(i))return decodeURIComponent(i.substring(i.indexOf("=")+1,i.length));return""},t.cookieExpireDays=365,t.storeKey="__CG",t.storeRegex=new RegExp("^(\\s)*"+t.storeKey+"=","i"),t}();u=function(){function n(){}return n.getValue=function(t,r){switch(r){case i.DNS:return n.getMetricValue(t.domainLookupEnd,t.domainLookupStart);case i.Connect:return n.getMetricValue(t.connectEnd,t.connectStart);case i.Load:return n.getMetricValue(t.responseEnd,t.responseStart||t.startTime);case i.Wait:return n.getMetricValue(t.responseStart,t.requestStart);case i.Start:return t.startTime;case i.Redirect:return n.getMetricValue(t.redirectEnd,t.redirectStart);case i.Duration:return t.duration;case i.SSL:if(t.secureConnectionStart)return t.connectEnd-t.secureConnectionStart}return 0},n.getMetricValue=function(n,t){if(n>=0&&n>=t&&t>=0)return n-t},n.addScriptTag=function(n,t){var i=t.document.createElement("script");i.type="text/javascript";i.src=l+n;t.document.body.appendChild(i)},n.getQueryStringValue=function(n){for(var u=o.search.substring(1),r=u.split("&"),t,i=0;i<r.length;i++)if(t=r[i].split("="),t[0]==n)return t[1];return""},n.stopEvents=function(){t&&t.eventManager.clear()},n}(),function(n){n.UserId="u";n.SessionId="s";n.SessionTime="t";n.PageViewCount="c";n.UrlCheckSum="k";n.PostFlag="f"}(f||(f={})),function(n){n[n.GET=0]="GET";n[n.POST=1]="POST";n[n.HEAD=2]="HEAD";n[n.DELETE=3]="DELETE";n[n.OPTIONS=4]="OPTIONS";n[n.PUT=5]="PUT";n[n.TRACE=6]="TRACE";n[n.CONNECT=7]="CONNECT"}(c||(c={})),function(n){n[n.DNS=0]="DNS";n[n.Connect=1]="Connect";n[n.Load=2]="Load";n[n.Wait=3]="Wait";n[n.Start=4]="Start";n[n.Redirect=5]="Redirect";n[n.Duration=6]="Duration";n[n.SSL=7]="SSL"}(i||(i={}));var k=function(){function n(){this.userId=-1;this.sessionId=0;this.sessionTime=0;this.pageViewCount=0;this.viewCount=0;this.pageViewId=0;this.postFlag=-1;this.sendWaterfall=!1;this.exitToEntry=0}return n.prototype.resetViewCount=function(){this.viewCount=1},n.prototype.save=function(){var n=this.getText();h.save(n)},n.prototype.load=function(){var e=h.read(),o,r,u,s,i,t,c,n;if(!e)return!1;for(o=e.split(","),r=0,u=o;r<u.length;r++)if(s=u[r],i=s.split(":"),i.length===2){if(t=i[0],typeof t=="string"&&(t=t.trim()),c=i[1],t===f.UrlCheckSum){this.urlCheckSum=c;continue}if(n=parseInt(i[1],10),!isNaN(n))switch(t){case f.UserId:this.userId=n;break;case f.SessionId:this.sessionId=n;break;case f.SessionTime:this.sessionTime=n;break;case f.PageViewCount:this.pageViewCount=n;break;case f.PostFlag:this.postFlag=n}}return!0},n.prototype.getText=function(){var n=f.UserId+":"+this.userId+",";return n+=f.SessionId+":"+this.sessionId+",",n+=f.SessionTime+":"+this.sessionTime+",",n+=f.PageViewCount+":"+this.pageViewCount+",",n+=f.UrlCheckSum+":"+this.urlCheckSum+",",n+(f.PostFlag+":"+this.postFlag)},n}(),d=function(){function i(){this.sessionExpire=18e5;this.store=new k}return i.prototype.updateSessionTime=function(){if(this.store){var n=(new Date).getTime();n-this.store.sessionTime>this.sessionExpire&&(this.store.sessionId=0);this.store.sessionTime=n;this.updateStore()}},i.prototype.updateStore=function(){this.store&&this.store.save()},i.prototype.initStore=function(){var i=this.store.load(),n,t;i&&this.store.postFlag==1&&(n=this.getUserId(r.sampleRate/100),t=n/(100/r.waterfallSampleRate),this.store.sendWaterfall=this.store.userId<=t)},i.prototype.resetPostFlag=function(){var n,t;if(this.store.postFlag=0,r.sampleRate<0){this.store.postFlag=-1;return}n=this.getUserId(r.sampleRate/100);this.store.userId<=n&&(this.store.postFlag=1,t=n/(100/r.waterfallSampleRate),this.store.sendWaterfall=this.store.userId<=t)},i.prototype.getReferrer=function(n){for(var i=this.getHostName(n).replace(":","-"),r=n.indexOf("?"),u=0,t=i.length;t<n.length;t++)u+=n.charCodeAt(t)%t;return i+"/"+(r<0?n.length:r)+"/"+n.length+"/"+u},i.prototype.getHostName=function(n){var i=n.indexOf("//")+2,t=n.indexOf("/",i);return i<2&&t==-1?n:(t==-1&&(t=n.length),n.substring(i,t))},i.prototype.init=function(){var r=t.data.start,i;return this.initStore(),this.store.userId==-1&&(i=this.store.userId,i!=a&&i>-1&&(this.store.userId=i,this.resetPostFlag())),(this.store.userId==-1||this.store.userId==a)&&(this.store.userId=this.getUserId(),this.resetPostFlag()),this.store.sessionId==0||r-this.store.sessionTime>this.sessionExpire?(this.store.sessionId=Math.floor(1+Math.random()*((Math.pow(2,32)-2)/2)),this.store.pageViewCount=1):(this.store.pageViewCount<65535&&this.store.pageViewCount++,this.getReferrer(n.document.referrer)==this.store.urlCheckSum&&this.store.sessionTime>0&&(this.store.exitToEntry=r-this.store.sessionTime)),this.store.sessionTime=(new Date).getTime(),this.store.pageViewId=Math.floor(1+Math.random()*((Math.pow(2,16)-2)/2)),this.store.urlCheckSum=this.getReferrer(n.location.href),this.store.resetViewCount(),this.updateStore(),this.store.load()},i.prototype.getUserId=function(n){return n===void 0&&(n=Math.random()),Math.floor(1+n*((Math.pow(2,64)-2)/2))},i.prototype.shouldPost=function(){return this.store.postFlag==1},i}(),v=function(){function n(n){this.char=n;this.children=[]}return n}(),y=function(){function n(){this.root=new v("");this.isReversed=!0}return n.prototype.add=function(n,t){var u,i,f,e,r;for(n===void 0&&(n=this.root),u=n.children,i=0,f=u;i<f.length;i++)if(e=f[i],e.char==t)return e;return r=new v(t),u.push(r),r.parent=n,r},n.prototype.toObject=function(){var n={},t=this.isReversed;return function i(n,r){var o=n.char=="",e,u,f;if(o)e=r;else{if(u=n.char,n.children.length==1)while(n.children.length==1)n=n.children[0],u=t?n.char+u:u+n.char;r[u]=n.data||{};e=r[u]}for(f=0;f<n.children.length;f++)i(n.children[f],e)}(this.root,n),n},n}(),p=function(){function n(n){this.dns=0;this.connect=0;this.load=0;this.wait=0;this.start=0;this.duration=0;this.redirect=0;this.ssl=0;this.url=n.name;var t=u.getValue;this.dns=t(n,i.DNS);this.connect=t(n,i.Connect);this.wait=t(n,i.Wait);this.load=t(n,i.Load);this.start=t(n,i.Start);this.duration=t(n,i.Duration);this.redirect=t(n,i.Redirect);this.ssl=t(n,i.SSL)}return Object.defineProperty(n.prototype,"url",{get:function(){return this._url},set:function(n){var i,t,u,r;n.indexOf("http://")!==-1?this.protocol=0:n.indexOf("https://")!==-1&&(this.protocol=1);i=n.split("/").slice(1,3).join("");t=i.indexOf(":");t!=-1&&(u=i.substr(t+1),r=parseInt(u),isNaN(r)||(this.port=r));n=n.substr(n.indexOf(i)+i.length);t=n.indexOf("?");t!=-1&&(n=n.substr(0,t));t=n.indexOf("#");t!=-1&&(n=n.substr(0,t));n=n.substr(0,64);this._url=n},enumerable:!0,configurable:!0}),n.prototype.translateForPost=function(){var t=Math.round,i={u:this.url,pr:this.protocol},n=function(n,t){typeof t!="number"||isNaN(t)||(i[n]=t)};return n("pt",this.port),n("dn",t(this.dns)),n("fc",t(this.connect)),n("ld",t(this.load)),n("wt",t(this.wait)),n("st",t(this.start)),n("rd",t(this.redirect)),n("dr",t(this.duration)),n("ssl",t(this.ssl)),i},n}(),w=function(n){function t(t,i,r){var u=n.call(this,i)||this;return u.responseTime=0,u.sendSize=0,u.responseSize=0,u.method=c[t.method.toUpperCase()],t.complete&&t.connectionEstablished&&(u.responseTime=t.complete-t.connectionEstablished),u.isSummary=r,r?(u.start=undefined,u.count=1):u.isAsync=t.isAsync,u.sendSize=t.sendSize||0,u.responseSize=t.responseSize||0,u}return __extends(t,n),t.prototype.update=function(n,t){var r=u.getValue;this.dns+=r(t,i.DNS);this.connect+=r(t,i.Connect);this.wait+=r(t,i.Wait);this.load+=r(t,i.Load);this.duration+=r(t,i.Duration);this.redirect+=r(t,i.Redirect);this.ssl+=r(t,i.SSL);this.sendSize+=n.sendSize||0;this.responseSize+=n.responseSize||0;this.count++},t.prototype.translateForPost=function(){var t=n.prototype.translateForPost.call(this);return this.isSummary?t.n=this.count:t.ia=this.isAsync?1:0,t.md=this.method,t.rp=Math.round(this.responseTime),t.ss=this.sendSize,t.rs=this.responseSize,t},t}(p),g=function(){function n(){this.count=0;this.dns=0;this.connect=0;this.load=0;this.wait=0;this.duration=0;this.redirect=0;this.ssl=0}return n.prototype.addAjaxItem=function(n,t){var i,r,u,f;if(this.update(t),i=new w(n,t,!0),typeof this._ajax=="undefined"){this._ajax=[];this._ajax.push(i);return}for(r=0,u=this._ajax;r<u.length;r++)if(f=u[r],f.url==i.url){f.update(n,t);return}this._ajax.length<10&&this._ajax.push(i)},n.prototype.update=function(n){var t=u.getValue;this.dns+=t(n,i.DNS);this.connect+=t(n,i.Connect);this.wait+=t(n,i.Wait);this.load+=t(n,i.Load);this.duration+=t(n,i.Duration);this.redirect+=t(n,i.Redirect);this.ssl+=t(n,i.SSL);this.count++},n.prototype.translateForPost=function(){var n=Math.round,u={n:this.count,dn:n(this.dns),fc:n(this.connect),ld:n(this.load),wt:n(this.wait),dr:n(this.duration),rd:n(this.redirect),ssl:n(this.ssl)},i,t,r,f;if(this._ajax){for(i=[],t=0,r=this._ajax;t<r.length;t++)f=r[t],i.push(f.translateForPost());u.ax=i}return u},n}(),nt=function(){function n(){this._resources=[]}return n.prototype.translateForPost=function(){for(var r,t=[],n=0,i=this._resources;n<i.length;n++)r=i[n],t.push(r.translateForPost());return t},n.prototype.addItem=function(n){var t=new p(n);this._resources.push(t)},n.prototype.addAjaxItem=function(n,t){var i=new w(n,t,!1);this._resources.push(i)},n}(),tt=function(t){function i(){var n=t!==null&&t.apply(this,arguments)||this;return n.maxJsErrors=10,n.charCodes={"\b":"\\b","\t":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\","&":"%26"},n.strRegex=/["&\\\x00-\x1f\x7f-\x9f]/g,n}return __extends(i,t),i.prototype.toString=function(n){var t=this.translateForPost(n);return typeof JSON=="undefined"?this.jsonStringify(t):JSON.stringify(t)},i.prototype.strEscape=function(n){var i=this.charCodes[n],t;return i?i:(t=n.charCodeAt(0),"\\u00"+Math.floor(t/16).toString(16)+(t%16).toString(16))},i.prototype.jsonStringify=function(n){var t=[],i,u,e,r,f;switch(typeof n){case"string":return this.strRegex.test(n)?'"'+n.replace(this.strRegex,this.strEscape)+'"':'"'+n+'"';case"number":return isFinite(n)?String(n):"null";case"boolean":return String(n);case"object":if(!n)return"null";if(n.constructor===Date,typeof n.length=="number"&&!n.propertyIsEnumerable("length")){for(i=0,u=n;i<u.length;i++)e=u[i],t.push(this.jsonStringify(e));return"["+t.join(",")+"]"}for(r in n)typeof r=="string"&&(f=this.jsonStringify(n[r]),!f||t.push(this.jsonStringify(r)+":"+f));return"{"+t.join(",")+"}"}return""},i.prototype.translateForPost=function(t){var i={},u,r,f,e;if(i.v=b,i.pt=this.postType,i.ui=this.userId,i.si=this.sessionId,i.di=this.siteId,i.pi=this.pageViewId,i.jsc=this.jsErrorCount||0,i.rf=this.referrer,i.pc=this.pageViewCount,i.vc=this.viewCount,i.dh=this.screenHeight,i.dw=this.screenWidth,i.rc=this.redirectCount||0,i.jsc=this.jsErrorCount||0,this.jsErrors&&this.jsErrors.length>0){for(u=[],r=0;r<Math.min(this.jsErrors.length,this.maxJsErrors);r++)u.push(this.translateErrorForPost(this.jsErrors[r]));i.jse=u}return(this.hasErrors&&(i.ae=this.getErrors()),this.hasIndicators&&(i.ind=this.getIndicators()),this.hasTracepoints&&(i.tra=this.getTracepoints()),this.isConversion&&(i.cv=this.isConversion?1:0,this.revenue&&(i.rv=this.revenue),this.revenueItems&&(i.ri=this.revenueItems)),this.pageGroup&&(i.pg=this.pageGroup),this.variation&&(i.ab=this.variation),(this.resources||this.ajaxRequests)&&(f=this.translateResources(this.resources,this.ajaxRequests),i.res=f.summary,t&&(i.wf=f.waterfall)),n.CPVisuallyComplete&&(e=n.CPVisuallyComplete.getValue(),typeof e=="number"&&(i.vct=e)),typeof this.isNewView=="boolean"&&(i.nv=this.isNewView?1:0),!this.isNewPageView)?(i.np=0,i):(i.np=1,i.dn=this.dns,i.fc=this.fullConnect,i.wt=this.wait,i.ld=this.load,i.de=this.domInteractive,i.dl=this.domLoaded,i.dc=this.docComplete,i.rp=this.response,i.cl=this.contentLoad,i.rd=this.redirect,i.rc=this.redirectCount||0,this.secureConnect&&(i.sc=this.secureConnect),this.exitToEntry&&(i.xe=this.exitToEntry),this.entryToOnLoad&&(i.el=this.entryToOnLoad),this.prerender&&(i.pr=this.prerender),i)},i.prototype.translateErrorForPost=function(n){var t={},i,r;return t.m=n.message,t.n=n.lineNumber,t.c=n.count+1,i=n.url,r=i.indexOf("?"),r!=-1&&(i=i.substr(0,r)),t.u=i,t},i.prototype.translateResources=function(n,t){var k=!!n,d=!!t,tt,r,c,v,u,i,p,h,l,w,b,f,e,s,a;if(!k&&!d)return null;if(tt=function(n){var r,u,f,i,e;if(!k||!d)return null;for(r=0,u=t;r<u.length;r++)if(f=u[r],i=f.url,i.indexOf("http")!=0&&(e=o.href.lastIndexOf("/"),i=o.href.substring(0,e)+"/"+i),i==n.name)return f;return null},r={},n)for(c=0,v=n;c<v.length;c++)(u=v[c],u)&&(i=u.name.split("/").slice(1,3).join(""),i&&i.length!=0)&&(p=i.indexOf(":"),p!=-1&&(i=i.substr(0,p)),r.hasOwnProperty(i)||(r[i]={summary:new g,waterfall:new nt}),h=r[i],l=tt(u),l?(h.summary.addAjaxItem(l,u),h.waterfall.addAjaxItem(l,u)):(h.summary.update(u),h.waterfall.addItem(u)));w=new y;for(f in r){for(e=undefined,s=f.length-1;s>=0;s--)a=f[s],e=w.add(e,a);e.data=r[f].summary.translateForPost()}b=new y;for(f in r){for(e=undefined,s=f.length-1;s>=0;s--)a=f[s],e=b.add(e,a);e.data=r[f].waterfall.translateForPost()}return{summary:w.toObject(),waterfall:b.toObject()}},i}(DataWrapper),it=function(){function i(){var i=this,c,f,e,o,h;if(this.visitor=new d,this.postUrl=r.postUrl,this.didSendInitial=!1,this.isDebugging=!1,this.countResourcesSent=0,this.didSoftNavigation=!1,this.currentUrl="",this.updateDebugData=function(){var n=i.createInitPostObject(PostType.OnBeforeUnload,!1),f=i.visitor.store.sendWaterfall||!!u.getQueryStringValue(r.waterfallParameter),e=n.toString(f);t.debugData=n;t.unloadDebugData=e},this.onPageLoad=function(){if(i.isDebugging){t.debugData=i.createInitPostObject(PostType.OnLoad,!1);t.updateDebugData=i.updateDebugData;t.sendData=function(){i.doPost(PostType.OnBeforeUnload,!1)};u.stopEvents();u.addScriptTag(r.debugUrl,n);return}i.visitor.updateSessionTime();i.doPost(PostType.OnLoad,!1)},this.captureSoftNavigations=function(){var r,u,f,e,o,s;(t.eventManager.add("hashchange",n,i.onSoftNavigation),r=n.history,r)&&(u="function",typeof r.go===u&&(f=r.go,r.go=function(n){i.onSoftNavigation();f.call(r,n)}),typeof r.back===u&&(e=r.back,r.back=function(){i.onSoftNavigation();e.call(r)}),typeof r.forward===u&&(o=r.forward,r.forward=function(){i.onSoftNavigation();o.call(r)}),typeof r.pushState===u&&(s=r.pushState,r.pushState=function(n,t,u){i.onSoftNavigation();s.call(r,n,t,u)}))},this.onViewVisuallyComplete=function(){i.didSoftNavigation&&i.doPost(PostType.OnLoad,!0)},this.onSoftNavigation=function(){var t;if(n.CPVisuallyComplete){t=n.CPVisuallyComplete;t.onComplete(i.onViewVisuallyComplete)}i.doPost(PostType.OnBeforeUnload,i.didSoftNavigation);i.visitor.store.viewCount++;!t||n.setTimeout(function(){t.reset()},0);i.didSoftNavigation=!0},this.doPost=function(n,f){var e;if(i.visitor.shouldPost()){n!=PostType.OnBeforeUnload||t.data.loadFired||(n=PostType.OnAbort);i.didSendInitial?e=i.createDiffPostObject(n,f):(e=i.createInitPostObject(n,f),i.didSendInitial=!0);var o=i.visitor.store.sendWaterfall||!!u.getQueryStringValue(r.waterfallParameter),s=n==PostType.OnBeforeUnload||n==PostType.OnAbort,h=o&&s;i.makeRequest(e,h)}},t&&t.data){if(c=this.visitor.init(),this.isDebugging=!!u.getQueryStringValue(r.debugParameter),!this.isDebugging&&!c){u.stopEvents();return}this.captureSoftNavigations();f=!1;e=function(){f||(t.data.loadFired=!0,f=!0,i.onPageLoad())};t.data.loadFired||!n.document||(t.data.loadFired=n.document.readyState=="complete");t.data.loadFired?e():t.eventManager.add(s.Load,parent.window,e);o=!1;h=function(){o||(o=!0,i.doPost(PostType.OnBeforeUnload,!1))};t.eventManager.add(s.BeforeUnload,n,h);t.eventManager.add(s.Unload,n,h)}}return i.prototype.createInitPostObject=function(i,u){var f=this.createBasePostObj(i,!0,u),s=this.visitor.store,o,e;return s.exitToEntry>0&&(f.exitToEntry=s.exitToEntry),o=t.data.loadTime-t.data.start,o>0&&(f.entryToOnLoad=o),document.webkitVisibilityState==="prerender"&&(f.prerender=1),n.performance&&(e=void 0,n.performance.getEntriesByType&&(e=n.performance.getEntriesByType("resource"),f.resources=e),i!=PostType.OnLoad&&(this.setClearResources(),r.clearResources&&n.performance.clearResourceTimings?n.performance.clearResourceTimings():this.countResourcesSent=e.length)),f},i.prototype.createDiffPostObject=function(t,i){var f=this.createBasePostObj(t,!1,i),u;return n.performance&&(u=[],n.performance.getEntriesByType&&(u=n.performance.getEntriesByType("resource")),t!=PostType.OnLoad&&(this.setClearResources(),r.clearResources&&n.performance.clearResourceTimings?(f.resources=u,n.performance.clearResourceTimings()):(f.resources=u.slice(this.countResourcesSent),this.countResourcesSent=u.length))),f},i.prototype.createBasePostObj=function(i,f,e){var o=new tt,h,s;return o.postType=i,o.isNewPageView=f,o.siteId=r.siteId,o.referrer=encodeURI(n.location.href),o.sampleRate=r.sampleRate,o.waterfallSampleRate=r.waterfallSampleRate,o.referrer=i===PostType.OnBeforeUnload||i===PostType.OnAbort?this.currentUrl||encodeURI(n.location.href):encodeURI(n.location.href),this.currentUrl=o.referrer,e&&(o.isNewView=i==PostType.OnLoad),h=this.visitor.store,o.userId=h.userId,o.sessionId=h.sessionId,o.pageViewId=h.pageViewId,o.pageViewCount=h.pageViewCount,o.viewCount=h.viewCount,o.screenHeight=screen.height,o.screenWidth=screen.width,t.data.jsCount>0&&(o.jsErrorCount=t.data.jsCount,o.jsErrors=t.data.jsErrors,t.clearErrors()),t.hasInsight&&(this.addInsightForPost(o),t.clearInfo()),t.data.ajax&&(o.ajaxRequests=t.data.ajax.slice(),t.clearAjax()),n.performance&&(s=n.performance.timing,o.dns=s.domainLookupEnd-s.domainLookupStart,o.fullConnect=s.connectEnd-s.connectStart,o.wait=s.responseStart-s.requestStart,o.load=s.responseEnd-s.responseStart,o.domInteractive=u.getMetricValue(s.domInteractive,s.navigationStart),o.domLoaded=u.getMetricValue(s.domContentLoadedEventStart,s.navigationStart),o.docComplete=u.getMetricValue(s.domComplete,s.navigationStart),o.response=u.getMetricValue(s.responseEnd,s.navigationStart),o.contentLoad=u.getMetricValue(s.loadEventStart,s.domLoading),o.redirect=s.redirectEnd-s.redirectStart,s.secureConnectionStart&&(o.secureConnect=s.connectEnd-s.secureConnectionStart),n.performance.navigation&&(o.redirectCount=n.performance.navigation.redirectCount)),o},i.prototype.setClearResources=function(){!n.__cpPreventResourceClear||(r.clearResources=n.__cpPreventResourceClear===!1)},i.prototype.addInsightForPost=function(n){var f=t.info,r,s,o,e,u,h,c,i;for(r in f)switch(r){case"appError":if(i=f[r],i&&typeof i=="object")for(e in i)(o=Number(e),isNaN(o))||(u=i[e],u&&typeof u=="string"&&(s=u,s.length>32&&(s=s.substring(0,32)),n.addError(e,s)));break;case"conversion":if(i=f[r],n.isConversion=!0,i&&typeof i=="object")for(e in i)(o=Number(e),isNaN(o))||(u=i[e],u&&typeof u=="number"&&(n.revenue=o,n.revenueItems=u));break;case"indicator":h=this.buildInsight(f[r],0);h[0]&&n.addIndicator(h[1]);break;case"tracepoint":c=this.buildInsight(f[r],"");c[0]&&n.addTracepoint(c[1]);break;case"pageGroup":i=f[r];i!==undefined&&typeof i=="string"&&(n.pageGroup=i);break;case"variation":i=f[r];i!==undefined&&typeof i=="string"&&(n.variation=i)}},i.prototype.buildInsight=function(n,t){var f={},i=!1,r,u;if(n&&typeof n=="object")for(r in n)r&&(u=n[r],u&&typeof u==typeof t&&(f[r]=u,i=!0));return i?[i,f]:[i,f]},i.prototype.makeRequest=function(t,i){var u=t.toString(i),r;n.navigator&&typeof n.navigator.sendBeacon=="function"?n.navigator.sendBeacon(this.postUrl,u):(r=new XMLHttpRequest,window.XDomainRequest&&(r=new window.XDomainRequest,r.timeout=0,r.onload=function(){},r.onerror=function(){},r.ontimeout=function(){},r.onprogress=function(){}),r.open("POST",this.postUrl,!1),r.setRequestHeader?r.setRequestHeader("Content-Type","application/x-www-form-urlencoded; charset=UTF-8"):null,r.send(u),r=null)},i}(),ut=new it}}();var w=parent.window||window;w.CPVisuallyComplete=function(){var t=function(){function n(){var n=this;this.pageWindow=w;this.start=0;this.waitMs=2e3;this.initiatorTypes=["img","iframe","css","script","subdocument"];this.calculate=function(){var t,i,r,u,f;if(!n.pageWindow.performance){n.trigger();return}for(t=n.start,i=[],n.pageWindow.performance.getEntriesByType&&(i=n.pageWindow.performance.getEntriesByType("resource")),r=0;r<i.length;r++)if(u=i[r],n.initiatorTypes.indexOf(u.initiatorType)!=-1){if(f=u.responseEnd,t===undefined){t=f;continue}t=Math.max(t,f)}n.maxResourceResponse=t;n.trigger()};this.trigger=function(){n.callback&&n.callback(n.getValue())};this.getValue=function(){return n.maxResourceResponse?n.maxResourceResponse-n.start:undefined};this.onComplete=function(t){n.callback=t};this.reset=function(){n.maxResourceResponse=undefined;n.pageWindow.performance&&(n.start=n.pageWindow.performance.now(),n.init())};this.init()}return n.prototype.init=function(){var i=this,u,f="scroll",e="click",o=function(){u=setTimeout(function(){r();i.calculate()},i.waitMs)},r=function(){n.removeEventListener(f,t);n.removeEventListener(e,t)},s=function(){n.addEventListener(f,t);n.addEventListener(e,t)},t=function(){clearTimeout(u);r();i.trigger()},n=this.pageWindow.document;n.readyState=="complete"?o():this.pageWindow.addEventListener("load",o);r();s()},n}(),n=new t;return{getValue:n.getValue,onComplete:n.onComplete,reset:n.reset}}();